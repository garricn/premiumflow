<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', path='site.css') }}" />
  </head>
  <body>
    <header>
      <h1>{{ title }}</h1>
      <nav class="top-nav">
        <a href="{{ url_for('imports_history') }}">View import history</a>
        <a href="{{ url_for('legs_view') }}">View matched legs</a>
        <a href="{{ url_for('cashflow_view') }}">Cash Flow & P&L</a>
        <a href="{{ url_for('stock_lots_view') }}">View stock lots</a>
        <a href="{{ url_for('cost_basis_view') }}">Cost basis overrides</a>
      </nav>
      <p>Welcome to the PremiumFlow web interface. Uploads and history views will appear here.</p>
    </header>
    <main>
      {% if message %}
      <section class="notice notice-{{ message.type }}">
        <h2>{{ message.title }}</h2>
        <p>{{ message.body }}</p>
      </section>
      {% endif %}
      {% if cost_basis_warnings %}
      <section class="notice notice-warning">
        <h2>Missing cost basis overrides</h2>
        <p>
          The following transfers still need manual cost basis entries.
          <a href="{{ url_for('cost_basis_view') }}">Open the cost basis dashboard</a> to resolve them.
        </p>
        <ul class="warning-list">
          {% for warning in cost_basis_warnings %}
          <li>
            {{ warning.account_name }}
            {% if warning.account_number %}
            ({{ warning.account_number }})
            {% endif %}
            • {{ warning.instrument }} • {{ warning.shares }} shares on {{ warning.activity_date }}
            {% if warning.status == "snoozed" %}
            <span class="badge">snoozed</span>
            {% endif %}
          </li>
          {% endfor %}
        </ul>
      </section>
      {% endif %}
      <section>
        <form action="/upload" method="post" enctype="multipart/form-data" class="upload-form">
          <fieldset>
            <legend>Upload CSV</legend>
            <label class="field">
              <span>Account name</span>
              <input
                type="text"
                name="account_name"
                value="{{ form.account_name }}"
                required
              />
            </label>
            <label class="field">
              <span>Account number</span>
              <input
                type="text"
                name="account_number"
                value="{{ form.account_number }}"
                required
              />
            </label>
            <label class="field">
              <span>CSV file</span>
              <input type="file" name="csv_file" accept=".csv" required />
            </label>
            <label class="field">
              <span>Duplicate handling</span>
              <select name="duplicate_strategy">
                <option value="error" {% if form.duplicate_strategy == "error" %}selected{% endif %}>
                  Error on duplicate (default)
                </option>
                <option value="skip" {% if form.duplicate_strategy == "skip" %}selected{% endif %}>
                  Skip existing import
                </option>
                <option value="replace" {% if form.duplicate_strategy == "replace" %}selected{% endif %}>
                  Replace existing import
                </option>
              </select>
            </label>
          </fieldset>
          <input type="hidden" name="options_only" value="true" />
          <input type="hidden" name="open_only" value="false" />
          <button type="submit">Upload CSV</button>
        </form>
      </section>
    </main>
  </body>
</html>
